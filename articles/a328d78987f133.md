---
title: "Rustæ–‡æ³• - ã‚¢ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ãƒˆ(#[...], #![...])"
emoji: "ğŸ“Œ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Rust"]
published: true
---

## ã‚¢ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ãƒˆ(Attributes)ã¨ã¯

ã‚¢ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ãƒˆ(Attributes)ã¨ã¯ã€ã€Œãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã€ã‚¯ãƒ¬ãƒ¼ãƒˆã€è¦ç´ (é–¢æ•°ã‚„Implãªã©)ã«å¯¾ã—ã¦ä»˜ä¸ã™ã‚‹ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã€ã§ã™ã€‚

ã‚¢ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ãƒˆã«ã¯é©ç”¨ã™ã‚‹å¯¾è±¡ã«ã‚ˆã£ã¦ã€**ã‚¢ã‚¦ã‚¿ãƒ¼ã‚¢ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ãƒˆ(Outer Attributes)** ã¨ **ã‚¤ãƒ³ãƒŠãƒ¼ã‚¢ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ãƒˆ(Inner Attributes)** ã®2ã¤ã«åˆ†ã‘ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚

ã‚¢ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ãƒˆã¯ä»¥ä¸‹ã®æ§˜ãªæ›¸ãæ–¹ã§å¼•æ•°ã‚’å–ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
```
#[attribute = "value"]
#[attribute(key = "value")]
#[attribute(value)]
```

### ã‚¢ã‚¦ã‚¿ãƒ¼ã‚¢ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ãƒˆ(Outer Attributes)

`#[ ... ]`ã§å®£è¨€ã—ã¾ã™ã€‚

ã‚¢ã‚¦ã‚¿ãƒ¼ã‚¢ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ãƒˆã¯ã€**æ§‹é€ ä½“ã€é–¢æ•°ã€åˆ—æŒ™å‹ã€å®Ÿè£…ã€ãƒˆãƒ¬ã‚¤ãƒˆã€å®šæ•°ã€ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãªã©ã®è¦ç´ **ã«é©ç”¨ã•ã‚Œã¾ã™ã€‚

ä¾‹ãˆã°ã€`#[derive(Debug)]` ã¯ã€`Debug`ãƒˆãƒ¬ã‚¤ãƒˆã‚’è‡ªå‹•çš„ã«å®Ÿè£…ã™ã‚‹ãŸã‚ã«æ§‹é€ ä½“ã‚„åˆ—æŒ™å‹ã«é©ç”¨ã•ã‚Œã¾ã™ã€‚

### ã‚¤ãƒ³ãƒŠãƒ¼ã‚¢ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ãƒˆ(Inner Attributes)

`#![ ... ]`ã§å®£è¨€ã—ã¾ã™ã€‚

ã‚¤ãƒ³ãƒŠãƒ¼ã‚¢ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ãƒˆã¯ã€**ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚„ã‚¯ãƒ¬ãƒ¼ãƒˆå…¨ä½“**ã«é©ç”¨ã•ã‚Œã¾ã™ã€‚ã“ã‚Œã‚‰ã®ã‚¢ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ãƒˆã¯ã€é€šå¸¸ã‚¯ãƒ¬ãƒ¼ãƒˆã®ãƒ«ãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ`lib.rs`ã‚„`main.rs`ï¼‰ã‚„ã€ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®å…ˆé ­ã«è¨˜è¿°ã•ã‚Œã¾ã™ã€‚

ä¾‹ãˆã°ã€`#![allow(dead_code)]`ã¯ã€ãã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¾ãŸã¯ã‚¯ãƒ¬ãƒ¼ãƒˆå…¨ä½“ã§æœªä½¿ç”¨ã®ã‚³ãƒ¼ãƒ‰ã«å¯¾ã™ã‚‹è­¦å‘Šã‚’æŠ‘åˆ¶ã™ã‚‹ãŸã‚ã«ä½¿ã‚ã‚Œã¾ã™ã€‚

## ã‚¢ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ãƒˆã®ç”¨é€”

- ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã®æ¡ä»¶åˆ†å²(`#[cfg(...)]`)
- ã‚¯ãƒ¬ãƒ¼ãƒˆåã€ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã€ç¨®é¡ï¼ˆãƒã‚¤ãƒŠãƒªã‹ã€ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‹ï¼‰ã®è¨­å®š(`#![crate_name = "..."]`, `#![crate_type = "..."]`, ....)
- ãƒªãƒ³ãƒˆã®ç„¡åŠ¹åŒ–(`#[allow(...)]`, `#[warn(...)]`, `#[deny(...)]`, `#[forbid(...)]`)
- ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ä»˜å±ã®æ©Ÿèƒ½ï¼ˆãƒã‚¯ãƒ­ã€ã‚°ãƒ­ãƒ–ã€ã‚¤ãƒ³ãƒãƒ¼ãƒˆãªã©ï¼‰ã®ä½¿ç”¨(`#![feature(...)]`, `#[derive(...)]`, `#[macro_export]`, ...)
- å¤–éƒ¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¸ã®ãƒªãƒ³ã‚¯(`#[link(...)]`)
- ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆç”¨ã®é–¢æ•°ã‚’æ˜ç¤º(`#[test]`)
- ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ç”¨ã®é–¢æ•°ã‚’æ˜ç¤º(`#[bench]`)

## ä»£è¡¨çš„ãªã‚¢ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ãƒˆ

- `#[cfg]`ï¼šæ¡ä»¶ä»˜ãã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚ç‰¹å®šã®æ¡ä»¶ä¸‹ã§ã®ã¿ã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã™ã‚‹å ´åˆã«ä½¿ç”¨ã—ã¾ã™ã€‚
    - [Conditional compilation](https://doc.rust-lang.org/reference/conditional-compilation.html#conditional-compilation)
    
    ```rust
    #[cfg(target_os = "linux")]
    fn do_something_linux_specific() {
        // Linuxå›ºæœ‰ã®å‡¦ç†
    }
    ```

    - `#[cfg(test)]`: Rustã®æ¡ä»¶ä»˜ãã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¢ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ãƒˆã®ä¸€ã¤ã§ã€ã“ã®ã‚¢ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ãƒˆãŒä»˜ä¸ã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰ã¯ã€ãƒ†ã‚¹ãƒˆãƒ“ãƒ«ãƒ‰æ™‚ã«ã®ã¿ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã•ã‚Œã¾ã™ã€‚ 
        ```rust
        // é€šå¸¸ã®ã‚³ãƒ¼ãƒ‰ï¼ˆãƒ†ã‚¹ãƒˆã¨æœ¬ç•ªãƒ“ãƒ«ãƒ‰ã®ä¸¡æ–¹ã§ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã•ã‚Œã‚‹ï¼‰
        fn add(a: i32, b: i32) -> i32 {
            a + b
        }

        // ãƒ†ã‚¹ãƒˆãƒ“ãƒ«ãƒ‰ã®ã¿ã§ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã•ã‚Œã‚‹ã‚³ãƒ¼ãƒ‰
        #[cfg(test)]
        mod tests {
            use super::*;

            #[test]
            fn test_add() {
                assert_eq!(add(1, 2), 3);
            }
        }
        ```


- `#[derive]`ï¼šæ§‹é€ ä½“ã‚„åˆ—æŒ™å‹ã«å¯¾ã—ã¦è‡ªå‹•å°å‡ºï¼ˆè‡ªå‹•å®Ÿè£…ï¼‰ã•ã‚Œã‚‹ãƒˆãƒ¬ã‚¤ãƒˆã‚’æŒ‡å®šã—ã¾ã™
    ```rust
    #[derive(Debug, PartialEq, Eq, Clone)]
    struct Point {
        x: i32,
        y: i32,
    }
    ```

- `#[test]`ï¼šãƒ†ã‚¹ãƒˆé–¢æ•°ã‚’å®šç¾©ã—ã¾ã™ã€‚ã“ã®ã‚¢ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ãƒˆãŒä»˜ä¸ã•ã‚ŒãŸé–¢æ•°ã¯ã€`cargo test`ã‚³ãƒãƒ³ãƒ‰ã§å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚

    ```rust
    #[cfg(test)]
    mod tests {
        #[test]
        fn test_addition() {
            assert_eq!(2 + 2, 4);
        }
    }
    ```

- `#[allow]`ã€`#[warn]`ã€`#[deny]`ã€`#[forbid]`ï¼šã“ã‚Œã‚‰ã®ã‚¢ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ãƒˆã¯ã€ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã®è­¦å‘Šã‚„ã‚¨ãƒ©ãƒ¼ã«å¯¾ã™ã‚‹æŒ™å‹•ã‚’åˆ¶å¾¡ã—ã¾ã™ã€‚

    ```rust
    #[allow(dead_code)]
    fn unused_function() {
        // ã“ã®é–¢æ•°ã¯æœªä½¿ç”¨ã§ã™ãŒã€dead_codeè­¦å‘ŠãŒè¡¨ç¤ºã•ã‚Œã¾ã›ã‚“ã€‚
    }
    ```

- `#[macro_export]`: ãƒã‚¯ãƒ­ã‚’å®šç¾©ã—ã€ä»–ã®ã‚¯ãƒ¬ãƒ¼ãƒˆã‹ã‚‰ã‚‚åˆ©ç”¨ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

    ```rust
    #[macro_export]
    macro_rules! my_macro {
        () => {
            println!("This is my macro!");
        };
    }
    ```

- `#[inline]`ã€`#[inline(always)]`ã€`#[inline(never)]`ï¼šã‚¤ãƒ³ãƒ©ã‚¤ãƒ³å±•é–‹ã®ãƒ’ãƒ³ãƒˆã‚’ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã«æä¾›ã—ã¾ã™ã€‚ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³å±•é–‹ã¯ã€é–¢æ•°å‘¼ã³å‡ºã—ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰ã‚’å‰Šæ¸›ã™ã‚‹æœ€é©åŒ–æ‰‹æ³•ã§ã™ã€‚
    - [Inlining - The Rust Performance Book](https://nnethercote.github.io/perf-book/inlining.html)
    ```rust
    #[inline]
    fn small_function() {
        // ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã«ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³å±•é–‹ã‚’æ¤œè¨ã•ã›ã‚‹ãƒ’ãƒ³ãƒˆã‚’ä¸ãˆã¾ã™ã€‚
    }
    ```

- `#![feature(<feature_name>)]`: ä¸»ã«nightlyã®æ©Ÿèƒ½ã‚’åˆ©ç”¨ã™ã‚‹éš›ã«å®£è¨€ã—ã¾ã™ã€‚ä»¥ä¸‹ã¯ç‹¬è‡ªã®ãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚’å®Ÿè£…ã™ã‚‹ãŸã‚ã«ã€[`custom_test_framework`](https://doc.rust-lang.org/unstable-book/language-features/custom-test-frameworks.html)ã‚’åˆ©ç”¨ã™ã‚‹éš›ã®ã‚³ãƒ¼ãƒ‰ã§ã™ã€‚
    ```rust
    #![feature(custom_test_frameworks)]
    #![test_runner(crate::test_runner)]
    ```

## é–¢é€£ãƒªãƒ³ã‚¯

- [Attributes - The Rust Reference](https://doc.rust-lang.org/reference/attributes.html)
- [ã‚¢ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ãƒˆ - Rust By Example æ—¥æœ¬èªç‰ˆ](https://doc.rust-jp.rs/rust-by-example-ja/attribute.html)
